---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Footer from "../../components/Footer.astro";
import SiteNav from "../../components/SiteNav.astro";
---

<BaseLayout
  title="CI guardrails for OpenAPI changes - TrueSpec"
  description="A step-by-step flow to add OpenAPI contract checks to GitHub Actions."
  canonical="https://truespec-app.com/learn/openapi-ci-guardrails"
>
  <SiteNav />

  <section class="py-20">
    <div class="mx-auto w-full max-w-3xl px-4">
      <a class="text-sm text-base-content/60 link link-hover" href="/learn">Back to Learn</a>

      <div class="mt-4 flex flex-wrap items-center gap-2 text-xs uppercase tracking-[0.3em] text-base-content/50">
        <span class="badge badge-outline accent-badge">How-to</span>
        <span>7 min read</span>
        <span class="text-base-content/30">â€¢</span>
        <span>Updated Jan 2026</span>
      </div>

      <h1 class="mt-4 text-3xl font-semibold md:text-4xl">
        CI guardrails for OpenAPI changes with GitHub Actions
      </h1>
      <p class="mt-4 text-base-content/70">
        The fastest way to stop spec drift is to add a contract check to every pull request. This
        guide shows the flow and a starter workflow you can adapt.
      </p>

      <div class="mt-8 space-y-8 text-base-content/70">
        <div>
          <h2 class="text-xl font-semibold text-base-content">Step 1: keep the spec in the repo</h2>
          <p class="mt-2">
            The OpenAPI document must live in the same repo as the service so changes stay visible.
            Store it in a predictable path, like <span class="font-mono text-xs">/openapi.yaml</span>.
          </p>
        </div>

        <div>
          <h2 class="text-xl font-semibold text-base-content">Step 2: run checks on pull requests</h2>
          <p class="mt-2">
            The goal is simple: diff the spec against the code and flag breaking changes before
            merge. Run this on every PR to keep the review signal tight.
          </p>
        </div>

        <div>
          <h2 class="text-xl font-semibold text-base-content">Step 3: share the report</h2>
          <p class="mt-2">
            Your reviewers should see a short summary with severity and affected endpoints. That
            keeps the discussion focused on risky diffs.
          </p>
        </div>
      </div>

      <div class="mt-8 card border border-base-300 bg-base-200/60">
        <div class="card-body gap-3">
          <h3 class="text-lg font-semibold">Starter GitHub Actions workflow</h3>
          <p class="text-base-content/70">
            This workflow calls the TrueSpec reports API and writes a summary into the PR checks tab.
          </p>
          <div class="mockup-code text-xs">
            <pre data-prefix="$"><code>name: api-contract</code></pre>
            <pre data-prefix="$"><code>on: [pull_request]</code></pre>
            <pre data-prefix="$"><code>jobs:</code></pre>
            <pre data-prefix="$"><code>  drift:</code></pre>
            <pre data-prefix="$"><code>    runs-on: ubuntu-latest</code></pre>
            <pre data-prefix="$"><code>    steps:</code></pre>
            <pre data-prefix="$"><code>      - uses: actions/checkout@v4</code></pre>
            <pre data-prefix="$"><code>        with:</code></pre>
            <pre data-prefix="$"><code>          fetch-depth: 0</code></pre>
            <pre data-prefix="$"><code>      - uses: actions/setup-node@v4</code></pre>
            <pre data-prefix="$"><code>        with:</code></pre>
            <pre data-prefix="$"><code>          node-version: 20</code></pre>
            <pre data-prefix="$"><code>      - uses: alessiobianchini/TrueSpecAction@v0</code></pre>
            <pre data-prefix="$"><code>        with:</code></pre>
            <pre data-prefix="$"><code>          spec-path: openapi.yaml</code></pre>
            <pre data-prefix="$"><code>          reports-token: $&#123;&#123; secrets.TRUESPEC_REPORTS_TOKEN &#125;&#125;</code></pre>
          </div>
          <p class="text-xs text-base-content/60">
            Add <span class="font-mono">TRUESPEC_REPORTS_TOKEN</span> as a repository secret.
          </p>
        </div>
      </div>

      <div class="mt-8 card border border-base-300 bg-base-200/60">
        <div class="card-body gap-3">
          <h3 class="text-lg font-semibold">Example PR summary</h3>
          <p class="text-base-content/70">
            The report shows severity, endpoint context, and schema-level diffs so reviewers can
            focus on breaking risk.
          </p>
          <div class="mockup-code text-xs">
            <pre data-prefix=">"><code>Summary</code></pre>
            <pre data-prefix=">"><code>Breaking: 5 | Warning: 3 | Info: 3</code></pre>
            <pre data-prefix=">"><code></code></pre>
            <pre data-prefix=">"><code>BREAKING (5)</code></pre>
            <pre data-prefix=">"><code>- Removed operation DELETE /v1/users/{id}</code></pre>
            <pre data-prefix=">"><code>- Removed response 404 for GET /v1/users</code></pre>
            <pre data-prefix=">"><code>- Enum changed at response.200.body.status</code></pre>
            <pre data-prefix=">"><code>- Removed field response.200.body.email</code></pre>
            <pre data-prefix=">"><code>- Type changed at request.body.price</code></pre>
            <pre data-prefix=">"><code></code></pre>
            <pre data-prefix=">"><code>WARNING (3)</code></pre>
            <pre data-prefix=">"><code>- New required parameter query:dryRun for PUT /v1/plans</code></pre>
            <pre data-prefix=">"><code>- Request body is now required for PUT /v1/plans</code></pre>
            <pre data-prefix=">"><code>- New required field request.body.name</code></pre>
            <pre data-prefix=">"><code></code></pre>
            <pre data-prefix=">"><code>INFO (3)</code></pre>
            <pre data-prefix=">"><code>- Added operation GET /v1/billing</code></pre>
            <pre data-prefix=">"><code>- Added response 422 for GET /v1/users</code></pre>
            <pre data-prefix=">"><code>- Added field response.200.body.tier</code></pre>
          </div>
        </div>
      </div>

      <div class="mt-10 card border border-base-300 bg-base-200/60">
        <div class="card-body gap-3">
          <h3 class="text-lg font-semibold">Request early access</h3>
          <p class="text-base-content/70">
            We are onboarding teams in batches. Join the waitlist and we will share new capabilities
            as soon as they are ready.
          </p>
          <div class="flex flex-wrap gap-3">
            <a class="btn btn-primary" href="/#waitlist">Join the waitlist</a>
            <a class="btn btn-ghost" href="/learn/api-change-checklist">PR checklist</a>
            <a class="btn btn-outline" href="https://github.com/alessiobianchini/TrueSpecAction" target="_blank" rel="noopener">
              View Action repo
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>
